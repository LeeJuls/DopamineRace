# HIST-004-B: 타이틀 씬 구현 히스토리

**작업일**: 2026-02-23
**작업자**: Claude (AI) + 사용자 감독
**관련 스펙**: SPEC-004-타이틀씬.md
**롤백 포인트**: `05a034a` (Phase 1), `d8a170e` (Phase 2), `8add01f` (Phase 3), `6eb189d` (Phase 4), `6ba5b9e` (Phase 5)

---

## 1. 작업 개요

타이틀 씬(TitleScene) 신규 추가 — 6단계 Phase별 구현 + 테스트.

## 2. Phase별 작업 내역

### Phase 1: 기반 구조 + 씬 전환 (`05a034a`)
- CharacterDatabase, TrackDatabase에 `DontDestroyOnLoad` 추가
- TitleSceneManager.cs 생성 (빈 씬 + 입력 → SampleScene 전환)
- TitleScene.unity 생성, Build Settings 인덱스 0으로 설정
- **테스트**: 씬 전환 정상, 싱글톤 중복 없음

### Phase 2: 비주얼 + 언어 선택 (`d8a170e`)
- 배경 이미지 (Resources/BG/main_title_bg) — SpriteRenderer + Cover-fit
- 타이틀 로고 (Resources/BG/main_title) — 뷰포트 y=0.65 배치
- "Press to Start" TextMesh 깜빡임 (sin파 alpha 0.3~1.0)
- 언어 선택 UI Canvas (우하단, ko/en/jp 3버튼)
- StringTable.csv에 `str.ui.press_start` 키 추가
- **테스트**: 전 요소 생성, 3개 언어 전환, 씬 전환 정상

### Phase 3: 캐릭터 달리기 (`8add01f`)
- TitleCharacterRunner.cs 생성
- CharacterDatabase에서 12캐릭터 랜덤 셔플 순차 스폰
- 프리팹 Instantiate → Animator "Run" 트리거 → Transform.Translate 이동
- 화면 우측 이탈 시 좌측 리셋 (GameObject 재활용)
- TitleSceneManager에서 CharacterDatabase 초기화 + Runner 통합
- **발견**: 프리팹에 RacerController 없음 (런타임 추가) → disable 불필요
- **테스트**: 12캐릭터 스폰/이동/전환정리 정상

### Phase 4: 블록 디졸브 전환 (`6eb189d`)
- SceneTransitionManager.cs 생성 (DontDestroyOnLoad 싱글톤)
- 16×10 격자 Image 블록 (160개) + Canvas sortingOrder 10000
- DissolveOut (랜덤 순서 블록 가림) → 검은 화면 → 씬 로드 → BuildupIn (블록 제거)
- TrackTransition(9999)과 공존
- **테스트**: 160블록 생성, 전환 완료, Canvas 비활성, 싱글톤 무중복

### Phase 5: BGM 시스템 (`6ba5b9e`)
- BGMManager.cs 재작성: DontDestroyOnLoad + PlayBGM/FadeIn/FadeOut/CrossFade
- 자동 재생 제거 (외부 제어 전용)
- TitleScene: Title_Bgm 페이드인 → 전환 시 페이드아웃
- SampleScene: 빌드업 완료 후 BGM 페이드인
- **테스트**: Title_Bgm → BGM 전환, 페이드 동작, 싱글톤 무중복

### Phase 6: 최종 통합 테스트
- TitleScene 전체 요소 확인 (배경/로고/텍스트/언어/캐릭터/BGM)
- 전환 플로우 (디졸브→로드→빌드업→BGM전환)
- SampleScene 정상 동작 (GameManager, 싱글톤 각 1개)
- 잔여물 없음 (TitleRunner=0, TitleSceneManager=destroyed)
- **결과**: 전 항목 통과

## 3. 신규/수정 파일

| 파일 | 상태 | 설명 |
|------|------|------|
| TitleSceneManager.cs | 신규 | 타이틀 씬 전체 관리 |
| TitleCharacterRunner.cs | 신규 | 캐릭터 달리기 연출 |
| SceneTransitionManager.cs | 신규 | 블록 디졸브 씬 전환 |
| BGMManager.cs | 재작성 | DontDestroyOnLoad + FadeIn/Out |
| CharacterDatabase.cs | 수정 | DontDestroyOnLoad 추가 |
| TrackDatabase.cs | 수정 | DontDestroyOnLoad 추가 |
| StringTable.csv | 수정 | str.ui.press_start 추가 |
| TitleScene.unity | 신규 | 타이틀 씬 (Build Index 0) |

## 4. 발견된 이슈 및 해결

1. **MCP Roslyn 타입 인식 불가**: 새로 생성한 C# 타입을 MCP Roslyn에서 못 찾음 → `MonoScript.GetClass()` + `AddComponent(type)` 우회
2. **Play 모드 비동기 전환**: `EditorApplication.isPlaying = false` 즉시 반영 안됨 → `delayCall` 체인 사용
3. **프리팹에 RacerController 없음**: 런타임에 SceneBootstrapper가 추가하는 구조 → TitleScene에서는 disable 불필요
4. **MCP AudioSource/TextMesh/Animator 타입 미인식**: Roslyn 어셈블리 제한 → 리플렉션 우회

## 5. 미완료/향후 작업

- [ ] 사용자 직접 플레이 테스트 (비주얼 확인, 타이밍 조정)
- [ ] 디졸브/빌드업 속도 미세 조정 (현재 각 1.2초)
- [ ] 캐릭터 스폰 Y위치/속도 미세 조정
- [ ] 로고 크기/위치 미세 조정
- [ ] SampleScene에서 직접 시작 시 BGM 재생 처리 (SceneBootstrapper 보완)
