# 히스토리: 부스트 피드백 시스템 + 타입 밸런스 튜닝
**날짜**: 2026-02-26
**브랜치**: main
**관련 명세서**: `Docs/specs/20260226_부스트피드백시스템_명세서.md`

---

## 작업 개요

이전 세션의 포지션 타겟팅 HP 소모 시스템(1차 타입 밸런스)에 이어,
**2차 시각적 임팩트 + 부스트 피드백 루프** 시스템을 추가했다.

사용자 요구사항:
1. "가속할 때 확 달리는 느낌이 전혀 안나네" → peakBoost 2배
2. "부스트 올라갈수록 HP 소모도 같이 증가하면?" → 피드백 루프
3. "power 스탯으로 더 빠르게 가속" → Power 가속 곡선 강화
4. "가속 최대치 2배" → 전 타입 peakBoost × 2

---

## 구현 내용

### 1. GameSettings.cs — 신규 파라미터
```csharp
[Header("═══ HP: 부스트 피드백 시스템 ═══")]
public float boostHPDrainCoeff = 3.0f;   // 확정: 1.5
public float powerAccelCoeff    = 0.5f;   // 확정: 0.5
```
- `runner_peakBoost` Range: 0.2f → 0.5f 로 확장

### 2. RacerController.cs — ConsumeHP() 수정
```csharp
// 부스트 피드백: 부스트 높을수록 HP 소모 증가
float boostAmp = 1f + gs.boostHPDrainCoeff * Mathf.Max(0f, hpBoostValue);
effectiveRate *= boostAmp;
```

### 3. RacerController.cs — CalcHPBoost() 수정
```csharp
// Power 기반 가속: power 높을수록 accelExp 낮아짐(가파른 곡선)
float powerFactor = 1f + (charData.charBasePower / 20f) * gs.powerAccelCoeff;
float effectiveAccelExp = accelExp / Mathf.Max(powerFactor, 0.1f);
```

### 4. RaceBacktestWindow.cs — SimConsumeHP / SimCalcHPBoost 미러링
- `SimConsumeHP()`: boostAmp 적용
- `SimCalcHPBoost()`: powerFactor 적용
- 추가: 구간별 포지션 추적 (`segCheckpoints` 7개 + 결승)
- 추가: 균등 스탯 토글 (`equalStats`, `equalStatValue`)

### 5. CharacterDB.csv — char_name_kr 컬럼 추가
- char_name(StringTable 키) 옆에 한글 이름 컬럼 추가
- 코드 파싱에 영향 없음 (읽기 편의용)

---

## 튜닝 과정 (6라운드)

| 라운드 | 변경 파라미터 | 도주 | 선행 | 선입 | 추입 | 판정 |
|--------|-------------|------|------|------|------|------|
| R1 (피드백 전) | 기준 | 11.7% | 22.3% | 28.3% | 37.7% | 추입 과강 |
| R1 (피드백 도입) | boostDrain=3, peak×2 | 4.0% | 12.7% | 29.6% | **53.7%** | ❌ 극심 불균형 |
| R2 | drain=1.5, K_peak=0.24, K_base=1.2, K_ar=7, C_ar=5.5 | 13.7% | 23.0% | 33.3% | 30.0% | ✅ 양호 |
| R3 | K_peak=0.26 | 46.0% | | | | ❌ 피드백 민감 |
| R4 | K_peak=0.25 | 11.3% | 17.7% | 31.0% | **40.7%** | ❌ 추입 과강 |
| R5 | K_peak=0.24, K_base=1.0 | 17.3% | 23.7% | 31.0% | 28.0% | 추입 약함 |
| **R6 (확정)** | **K_base=1.1**, 500회 | **16.0%** | **22.2%** | **27.4%** | **34.4%** | ✅ 최적 |

*K=Reckoner, C=Chaser, ar=activeRate, base=baseRate, peak=peakBoost*

---

## 확정 파라미터 (GameSettings.asset)

| 파라미터 | 이전 값 | **확정 값** | 비고 |
|---------|--------|------------|------|
| boostHPDrainCoeff | - | **1.5** | 신규 |
| powerAccelCoeff | - | **0.5** | 신규 |
| runner_peakBoost | 0.08 | **0.20** | 2.5× |
| leader_peakBoost | 0.09 | **0.20** | 2.2× |
| chaser_peakBoost | 0.12 | **0.24** | 2× |
| reckoner_peakBoost | 0.16 | **0.24** | 1.5× |
| chaser_activeRate | 6.5 | **5.5** | 스퍼트 완화 |
| reckoner_activeRate | 9 | **7** | 스퍼트 완화 |
| reckoner_baseRate | 0.8 | **1.1** | 보존 소모 적정화 |

---

## 백테스트 최종 결과 (균등스탯 20, 충돌ON, settling 2.0s)

### 거리별 타입 승률 (목표 vs 실측)
| 타입 | 목표 | 2바퀴 | **4바퀴** | 5바퀴 |
|------|------|-------|---------|-------|
| 도주 | 15% | 21.4% | **16.0%** | 13.6% |
| 선행 | 20% | 31.4% | **22.2%** | 18.4% |
| 선입 | 30% | 27.8% | **27.4%** | 33.8% |
| 추입 | 35% | 19.4% | **34.4%** | 34.2% |

### 4바퀴 구간별 포지션 아크 (평균 순위)
```
구간   도주    선행    선입    추입
10%   2.48   4.34   5.31   5.90  ← 도주 선두 / 추입 최후미
50%   4.43   4.10   4.41   5.08  ← 선행 안정 리드
80%   4.46   3.94   4.51   5.11  ← 선행 피크
결승   5.13   4.51   4.04   4.33  ← 선입/추입 역전
```

---

## 발견된 이슈

### ⚠️ 혜성(추입 002) 실제 스탯에서 46.8% 지배
**원인 분석**:
- `power 20` → `effectiveAccelExp = 1.8/(1+0.5) = 1.2` — 추입인데 부스트 가속이 선행 수준
- `brave 20` → 충돌 슬링샷 이득 최대 (+8.07)
- 추입 HP 보존 × power 빠른 가속 = 이중 시너지
- 근본 원인: `powerAccelCoeff`가 추입 타입에게 특히 유리하게 작용

**대응**: 다음 세션에서 별도 캐릭터 스탯 밸런싱 + 타입 밸런스 방향 재검토

---

## 수정 파일 목록

| 파일 | 변경 유형 | 주요 내용 |
|------|---------|---------|
| `Assets/Scripts/Data/GameSettings.cs` | 수정 | boostHPDrainCoeff/powerAccelCoeff 추가 |
| `Assets/Scripts/Racer/RacerController.cs` | 수정 | ConsumeHP 피드백, CalcHPBoost Power가속 |
| `Assets/Scripts/Editor/RaceBacktestWindow.cs` | 수정 | 미러링 + 구간추적 + 균등스탯 토글 |
| `Assets/Resources/GameSettings.asset` | 수정 | 확정 파라미터 값 적용 |
| `Assets/Resources/Data/CharacterDB.csv` | 수정 | char_name_kr 컬럼 추가 |
