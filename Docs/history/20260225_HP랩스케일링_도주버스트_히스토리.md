# HP 랩 스케일링 + 도주 버스트 + 장거리 역전 드라마 히스토리

**날짜**: 2026-02-25
**작업 범위**: 유저 플레이테스트 3대 피드백 해결
**수정 파일**: GameSettings.cs, GameSettings.asset, RacerController.cs, RaceBacktestWindow.cs

---

## 1. 유저 피드백 (원문)

1. "4바퀴째 가면 속도가 너무 줄어들어서 속도감이 너무 안남. 긴장감 사라짐."
2. "도주가 처음부터 팍!! 튀고 나가야 하는데, 그러질 못함. 초반에 못 달리면 절대 역전 없음."
3. "뒤에서 튀고 달리면서 역전하는 케이스를 못 봄. 장거리는 추입/선입이 뒤에 있다가 쭉 따라가면서 역전! 이 맛이 있어야 하는데, 4바퀴 반이면 이미 순위 정해짐."

## 2. 근본 원인

**HP 풀이 장거리 레이스에 비해 너무 작음:**
- Runner(end=15): maxHP=87.5, 소모율=4.3/s → **20.3초에 탈진 (5바퀴 중 2.7바퀴)**
- 모든 타입이 3~3.8바퀴에 HP=0 → 나머지 1.2~2바퀴 탈진 페널티
- Set W는 혼합 바퀴 평균으로 튜닝되어 2-3바퀴에선 균형, 5바퀴에서 구조적 결함

## 3. 해결 방안

### Part 1: HP 랩 스케일링
- 새 파라미터 `hpLapReference = 3` (기준 바퀴 수)
- `maxHP = CalcMaxHP(endurance) × max(1, laps / hpLapReference)`
- 5바퀴: maxHP 87.5 → 145.8 (+67%) → 탈진 시점 54%→**90%**
- 2-3바퀴: 변화 없음 (Set W 밸런스 보존)

### Part 2: 도주 버스트 강화
- `hp_earlyBonus_Runner` 0.06 → **0.12** (2배)
- `hp_earlyBonusFadeEnd` 0.40 → **0.25** (짧고 강렬한 스파이크)
- 효과: 레이스 시작 시 12% 속도 우위, 25%에서 0으로 페이드

### Part 3: 장거리 후반 타입 증폭
- 새 파라미터 `longRaceLateBoostAmp = 0.15`
- 장거리 시 Chaser/Reckoner peakBoost 증폭
- 5바퀴: lapExcess = 2/3 = 0.667, 증폭 = ×1.10 (+10%)

### + roundLaps 조정
- 1바퀴 레이스 제거: `[1,2,1,5,3,1,4]` → `[2,2,3,5,3,2,4]`

## 4. 수학적 검증

| 바퀴 | maxHP (end=15) | 탈진 시점 | 피크 부스트 |
|------|:-----------:|:------:|:--------:|
| 3 (Before) | 87.5 | 90% (랩 2.7) | 랩 1.1 |
| 5 (Before) | 87.5 | **54% (랩 2.7)** ← 문제! | 랩 1.1 |
| 3 (After) | 87.5 | 90% (랩 2.7) | 랩 1.1 |
| 5 (After) | **145.8** | **90% (랩 4.5)** ← 해결! | **랩 1.8** |

→ 탈진 시점이 바퀴 수와 무관하게 레이스 90% 지점으로 일정

## 5. 파라미터 변경 요약

| 파라미터 | 이전 | 이후 | 목적 |
|---------|:---:|:---:|------|
| hpLapReference | (신규) | 3 | HP 스케일링 기준 |
| longRaceLateBoostAmp | (신규) | 0.15 | 장거리 후반 타입 증폭 |
| hp_earlyBonus_Runner | 0.06 | 0.12 | 도주 초반 버스트 |
| hp_earlyBonusFadeEnd | 0.40 | 0.25 | 짧고 강한 스파이크 |
| roundLaps | [1,2,1,5,3,1,4] | [2,2,3,5,3,2,4] | 1바퀴 레이스 제거 |

## 6. 확인 필요 사항

- [ ] Unity RaceBacktestWindow에서 3바퀴/5바퀴 비교 백테스트
- [ ] 5바퀴 레이스: Runner 초반 리드 → Chaser/Reckoner 후반 역전 패턴 확인
- [ ] 3바퀴 레이스: Set W 밸런스 유지 확인
- [ ] 런타임 플레이테스트: 속도감/긴장감 체감
