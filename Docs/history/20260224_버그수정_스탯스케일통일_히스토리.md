# 히스토리: 버그 수정 + 스탯 스케일 통일

- **날짜**: 2026-02-24
- **커밋**: `240471e`, `7f70600`

---

## 작업 개요

1. 2라운드 레이서 미출발 버그 수정
2. 영문 텍스트 오버플로우 수정
3. 다국어 7개 언어로 확장
4. charBaseSpeed 스케일 통일 (소수 → 1~20 정수, 수식 개선)
5. 문서 폴더 정리 (`doc/` 폐기 → `Docs/` 통합)

---

## 1. 2라운드 레이서 미출발 버그

### 증상
2라운드에서 특정 캐릭터(혜성)가 출발하지 않아 경기가 종료되지 않는 버그

### 원인 분석
**Bug 1**: `ResetRacer()`에서 5개 변수 리셋 누락
- `noiseValue`, `noiseTimer`, `luckTimer`, `deviationTarget`, `deviationTimer`

**Bug 2 (방어적 수정)**: `CalculateSpeed()`의 나눗셈 위험
- `speed -= GetFatigue() / condMul` — condMul이 0에 가까우면 피로가 폭발
- 기본값(0.90f)에서는 문제 없으나 커스텀 설정 시 위험

### 수정 내용
```csharp
// RacerController.ResetRacer() — 누락 변수 추가
noiseValue = 0f;
noiseTimer = 0f;
luckTimer = 0f;
deviationOffset = 0f;
deviationTarget = 0f;
deviationTimer = 0f;

// RacerController.CalculateSpeed() — 안전 가드
condMul = Mathf.Max(condMul, 0.3f);  // 0 근처 나눗셈 방지

// 속도 바닥 진단용 경고
if (speed < 0.15f)
    Debug.LogWarning($"[RacerController] {charData.DisplayName} 속도 바닥! ...");
```

---

## 2. 영문 텍스트 오버플로우

### 증상
배팅 UI에서 언어를 영어로 변경 시 "Place Your Bet!" 등 텍스트가 컨테이너를 벗어남

### 수정 내용
`SceneBootstrapper.Betting.cs`에서 런타임으로 BestFit 적용 (프리팹 재빌드 불필요)

```csharp
if (betTitleText != null) {
    betTitleText.resizeTextForBestFit = true;
    betTitleText.resizeTextMinSize = 16;
    betTitleText.resizeTextMaxSize = 26;
}
```

---

## 3. 다국어 7개 언어 확장

- **추가 언어**: 중국어(cn), 독일어(de), 스페인어(es), 포르투갈어-브라질(br)
- `Loc.cs`: 7개 언어 파싱 지원
- `StringTable.csv`: 154개 키 전체 번역 추가

---

## 4. charBaseSpeed 스케일 통일

### 문제
- 기존: speed만 소수(0.9~1.2), 나머지 스탯은 1~20 정수
- 레이더 차트 표시 시 speed만 `×10f` 특수 처리 필요
- `/20f` 적용 후에도 격차 문제: speed 15 vs 20 → 0.75 vs 1.0 (25% 차이)

### 해결
**수식**: `SpeedMultiplier = 0.8f + charBaseSpeed * 0.01f`

| charBaseSpeed | 속도 배율 |
|---|---|
| 20 | 1.00 |
| 15 | 0.95 |
| 10 | 0.90 |
| 5  | 0.85 |

**격차**: 최대 10% (기존 25% → 대폭 완화)

### 구현
`CharacterData.cs`에 프로퍼티 추가 → 5곳에서 일괄 참조

```csharp
// CharacterData.cs
public float SpeedMultiplier => 0.8f + charBaseSpeed * 0.01f;
```

적용 파일:
- `RacerController.cs` — `GetBaseTrackSpeed`, `GetBaseSpeed`
- `RaceDebugOverlay.cs` — baseSpd 계산
- `RaceBacktestWindow.cs` — 2곳

레이더 차트(`CharacterInfoPopup.cs`)의 `×10f` 스케일링도 제거 (모든 스탯 1~20 통일)

---

## 5. 문서 폴더 정리

- `doc/` 폴더 폐기
- 히스토리 문서 이동: `doc/` → `Docs/history/`
- 폴더 규칙 확정:
  - 히스토리: `Docs/history/`
  - 명세서: `Docs/specs/`
  - 그 외: `Docs/`

---

## 테스트 결과

- Unity 컴파일 오류 없음 확인
- charBaseSpeed DB 값 사용자 직접 1~20 정수로 1차 밸런싱 완료
- 런타임 플레이 테스트는 사용자 직접 수행 필요

---

## 관련 파일

| 파일 | 변경 내용 |
|---|---|
| `Assets/Scripts/Racer/RacerController.cs` | ResetRacer 리셋 추가, condMul 안전 가드, SpeedMultiplier 적용 |
| `Assets/Scripts/Data/CharacterData.cs` | SpeedMultiplier 프로퍼티 추가 |
| `Assets/Scripts/Debug/RaceDebugOverlay.cs` | SpeedMultiplier 적용 |
| `Assets/Scripts/Editor/RaceBacktestWindow.cs` | SpeedMultiplier 적용 |
| `Assets/Scripts/Manager/UI/CharacterInfoPopup.cs` | 레이더차트 ×10f 제거 |
| `Assets/Scripts/Manager/UI/SceneBootstrapper.Betting.cs` | BestFit 런타임 적용 |
| `Assets/Scripts/Utility/Loc.cs` | 7개 언어 지원 |
| `Assets/Resources/Data/StringTable.csv` | 7개 언어 154개 키 |
| `Assets/Resources/Data/CharacterDB.csv` | speed 값 1~20 정수로 변환 |
