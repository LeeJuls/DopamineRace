# DopamineRace 타이틀 씬 명세서
**버전:** 1.0  
**날짜:** 2026-02-23  
**작업 범위:** TitleScene 신규 생성 + 씬 전환 시스템

---

## 1. 개요

게임 실행 시 가장 먼저 표시되는 타이틀 화면.  
배경 이미지 + 타이틀 로고 + "Press to Start" 텍스트 + 하단 캐릭터 달리기 연출로 구성.  
입력 시 블록 디졸브 전환으로 기존 GameScene(배팅 화면)으로 이동.

---

## 2. 씬 구조

```
TitleScene (새로 생성)  →  [블록 디졸브 전환]  →  GameScene (기존)
```

### Build Settings 순서
| Index | 씬 | 역할 |
|-------|-----|------|
| 0 | TitleScene | 타이틀 화면 (게임 진입점) |
| 1 | GameScene | 기존 게임 루프 (Betting→Racing→Result→Finish) |

### DontDestroyOnLoad 영향 없음
- CharacterDatabase, TrackDatabase는 이미 DontDestroyOnLoad 적용됨
- GameManager, ScoreManager 등은 GameScene 진입 시 초기화되는 기존 방식 유지
- BGMManager는 TitleScene에서 별도 인스턴스로 동작하거나, DontDestroyOnLoad로 전환 필요 (아래 BGM 섹션 참고)

---

## 3. 화면 구성

### 3-1. 레이어 구조 (아래→위 순서)

```
[Layer 0] 배경 이미지     — main_title_bg (전체 화면 채움)
[Layer 1] 캐릭터 달리기    — 하단 길 위에서 좌→우 이동
[Layer 2] 타이틀 로고      — main_title (화면 상단~중앙)
[Layer 3] "Press to Start" — 화면 중하단, 깜빡임 애니메이션
[Layer 4] 전환 오버레이    — 블록 디졸브 이펙트 (평소 비활성)
```

### 3-2. 배경 이미지
- **파일:** `Assets/Resources/BG/main_title_bg`
- **배치:** 카메라 전체 영역 채움 (SpriteRenderer, 카메라 크기에 맞춰 스케일)
- **Sorting Layer/Order:** 가장 뒤 (Order: -10)

### 3-3. 타이틀 로고
- **파일:** `Assets/Resources/BG/main_title`
- **배치:** 화면 상단~중앙 영역
- **Sorting Order:** 배경보다 앞 (Order: 5)
- **연출:** 없음 (정적 이미지) — 또는 미세한 호흡 애니메이션 (선택사항)

### 3-4. "Press to Start" 텍스트
- **폰트:** Neo둥근모 (FontHelper 활용)
- **위치:** 화면 중하단 (카메라 뷰포트 기준 약 y=0.25~0.3)
- **색상:** 흰색 (또는 밝은 색)
- **애니메이션:** 알파값 깜빡임 (1.0 ↔ 0.3, 주기 약 1~1.5초, PingPong)
- **Sorting Order:** 10

### 3-5. 캐릭터 달리기 연출
- **대상:** 전체 12캐릭터
- **누적 등장 방식:**
  - 게임 시작 약 1초 후 첫 캐릭터 등장 (화면 왼쪽 밖에서)
  - 이후 1~2초 랜덤 간격으로 새로운 캐릭터가 1마리씩 추가 등장
  - 캐릭터는 사라지지 않고 계속 누적됨
  - 화면 오른쪽 밖으로 나간 캐릭터 → 왼쪽에서 재진입 (계속 달림)
  - 결과: 시간이 지날수록 여러 캐릭터가 줄줄이 달리고 있는 장면
  - 12캐릭터 전부 등장하면 스폰 중지, 이미 나온 캐릭터들만 계속 순환
- **이동:** 좌→우, 캐릭터마다 약간 다른 속도 (자연스러운 간격 유지)
- **위치:** 배경 이미지 하단 길 영역 (y좌표 고정 또는 약간의 랜덤)
- **Sorting Order:** 배경과 타이틀 사이 (Order: 0~3)

#### 캐릭터 달리기 구현 방식
기존 `RacerController`를 직접 사용하면 GameManager 등 의존성이 복잡해지므로,  
**`TitleCharacterRunner`라는 경량 컴포넌트를 새로 만들어** 다음만 처리:
- 스프라이트 로드 (CharacterData의 run 스프라이트)
- run 애니메이션 재생 (프레임 순환)
- 좌→우 이동 (단순 Transform.Translate)
- 화면 밖 나가면 왼쪽으로 리셋

---

## 4. 입력 처리

### "Press to Start" 트리거
- **마우스 클릭** (Input.GetMouseButtonDown(0))
- **아무 키** (Input.anyKeyDown)
- **터치** (Input.touchCount > 0 && first touch began)
- 입력 감지 시 → 전환 시퀀스 시작
- **전환 중 입력 무시** (중복 트리거 방지 플래그)

---

## 5. 화면 전환 연출

### 5-1. 전체 시퀀스

```
[입력 감지]
  → ① BGM 페이드아웃 시작 (약 1.5초)
  → ② Press to Start 텍스트 비활성화
  → ③ 블록 디졸브 아웃 시작 (약 1.0~1.5초)
       타이틀 화면이 격자 블록 단위로 랜덤 순서로 사라짐
  → ④ 완전히 검은 화면 (약 0.2~0.3초 유지)
  → ⑤ SceneManager.LoadScene("GameScene")
  → ⑥ GameScene 로드 완료 후: 블록 빌드업 인 (약 1.0~1.5초)
       배팅 화면이 격자 블록 단위로 랜덤 순서로 나타남
  → ⑦ 빌드업 완료 후 게임 BGM 페이드인 시작
```

### 5-2. 블록 디졸브 상세

| 항목 | 값 |
|------|-----|
| 격자 크기 | 화면을 약 16×10 또는 20×12 블록으로 분할 (도트 감성) |
| 블록 사라지는 순서 | 랜덤 셔플 |
| 각 블록 사라지는 속도 | 전체 블록이 약 1.0~1.5초 안에 모두 사라짐 (등간격 또는 웨이브) |
| 블록 사라지는 방식 | 알파 0으로 즉시 전환 (팍팍 사라지는 느낌) |
| 뒤에 보이는 것 | 검은 배경 (Camera clear color = black) |

### 5-3. 블록 빌드업 상세

| 항목 | 값 |
|------|-----|
| 격자 크기 | 디졸브와 동일 |
| 블록 나타나는 순서 | 랜덤 셔플 (디졸브와 다른 시드) |
| 각 블록 나타나는 속도 | 전체 블록이 약 1.0~1.5초 안에 모두 나타남 |
| 블록 나타나는 방식 | 알파 0→1 즉시 전환 |
| 오버레이 위치 | GameScene의 카메라 위에 오버레이 → 블록이 하나씩 투명해지며 아래 배팅 화면 노출 |

### 5-4. 구현 방식

**SceneTransitionManager** (DontDestroyOnLoad) — 씬 간 전환을 관리하는 독립 오브젝트

```
구현 옵션:
A) UI Canvas + Image Grid 방식
   - Screen Space Overlay Canvas 위에 격자형 Image 컴포넌트 배치
   - 각 Image의 color.a를 제어
   - 장점: 해상도 독립적, UI 위에 확실히 렌더링
   - 단점: 블록 수만큼 Image 오브젝트 생성 (16×10 = 160개, 성능 OK)

B) RenderTexture + Shader 방식
   - 카메라 출력을 RenderTexture로 캡처 후 커스텀 쉐이더로 블록 디졸브
   - 장점: 성능 우수, 블록 수 무제한
   - 단점: 쉐이더 작업 필요, 디버그 어려움

→ 권장: A안 (UI Canvas 방식) — 도트 게임에 160개 Image는 성능 문제 없고, 구현/디버그 쉬움
```

---

## 6. BGM 시스템

### 6-1. 타이틀 BGM
- **파일:** `Assets/Resources/Audio/Title_Bgm.mp3`
- **재생:** TitleScene 로드 시 즉시 루프 재생
- **볼륨:** GameSettings.bgmVolume 참조 (또는 별도 설정)

### 6-2. 전환 시 BGM 처리

```
[Press to Start 입력]
  → 타이틀 BGM 페이드아웃 (약 1.5초, 현재 볼륨 → 0)
  → [씬 전환]
  → 블록 빌드업 완료 후
  → 게임 BGM 페이드인 (약 1.0초, 0 → 목표 볼륨)
```

### 6-3. BGMManager 확장
현재 BGMManager가 싱글톤이므로:
- **옵션 A:** BGMManager를 DontDestroyOnLoad로 만들고, TitleScene에서도 사용
- **옵션 B:** TitleScene 전용 AudioSource로 타이틀 BGM 재생, GameScene 진입 시 기존 BGMManager가 게임 BGM 처리

→ **권장: 옵션 A** — BGMManager를 DontDestroyOnLoad로 확장하고, `FadeOut()` / `FadeIn()` / `PlayBGM(clip)` 메서드 추가

---

## 7. 신규 스크립트 목록

| 파일 | 위치 | 역할 |
|------|------|------|
| `TitleSceneManager.cs` | Assets/Scripts/Manager/ | 타이틀 씬 전체 관리 (UI 배치, 입력 감지, 전환 시퀀스 시작) |
| `TitleCharacterRunner.cs` | Assets/Scripts/Racer/ | 타이틀 화면 전용 경량 캐릭터 러너 (스프라이트 + 이동) |
| `SceneTransitionManager.cs` | Assets/Scripts/Manager/ | 블록 디졸브/빌드업 전환 효과 + 씬 로딩 (DontDestroyOnLoad) |

### 수정 스크립트

| 파일 | 수정 내용 |
|------|-----------|
| `BGMManager.cs` | DontDestroyOnLoad 추가, FadeIn/FadeOut/PlayBGM 메서드 추가 |
| `GameManager.cs` | (수정 최소화) 씬 로드 시 자동 시작하는 기존 로직 유지 |

---

## 8. 리소스 체크리스트

| 리소스 | 경로 | 상태 |
|--------|------|------|
| 배경 이미지 | Assets/Resources/BG/main_title_bg | ✅ 있음 |
| 타이틀 로고 | Assets/Resources/BG/main_title | ✅ 있음 |
| 타이틀 BGM | Assets/Resources/Audio/Title_Bgm.mp3 | ✅ 있음 |
| 캐릭터 스프라이트 | 기존 캐릭터 에셋 | ✅ 있음 |
| Neo둥근모 폰트 | Assets/Fonts/NeoDunggeunmo/neodgm.ttf | ✅ 있음 |

---

## 9. 구현 순서 (TODO) — 단계별 테스트 포함

> ⚠️ 각 Phase 완료 후 반드시 중간 테스트를 통과한 뒤 다음 Phase로 진행.
> 버그 발견 시 해당 Phase에서 해결 후 넘어가기.

---

### Phase 1: 기반 구조 + 빈 씬 확인
- [ ] TitleScene 씬 파일 생성
- [ ] Build Settings에 TitleScene(0), GameScene(1) 등록
- [ ] TitleSceneManager 기본 구조 작성 (빈 껍데기)
- [ ] 카메라 설정 (Orthographic, 배경색 검정)

**🧪 테스트 1: 빈 씬 전환**
| 확인 항목 | 기대 결과 |
|----------|-----------|
| Play 버튼 | TitleScene이 첫 화면 (검은 화면 OK) |
| 아무 키 입력 | `SceneManager.LoadScene("GameScene")` → 기존 배팅 화면 정상 표시 |
| GameScene 동작 | 배팅/레이싱 기존 기능 정상 (씬 분리로 인한 깨짐 없음) |
| 콘솔 | NullRef, MissingRef 에러 없음 |

> 이 테스트가 가장 중요! 씬 분리가 기존 시스템을 깨뜨리지 않는지 확인.

---

### Phase 2: 타이틀 화면 비주얼
- [ ] 배경 이미지 배치 (main_title_bg, 카메라 맞춤 스케일)
- [ ] 타이틀 로고 배치 (main_title)
- [ ] "Press to Start" 텍스트 생성 (FontHelper, Neo둥근모)
- [ ] Press to Start 깜빡임 애니메이션 (알파 PingPong)

**🧪 테스트 2: 정적 화면 확인**
| 확인 항목 | 기대 결과 |
|----------|-----------|
| 화면 구성 | 배경 전체 채움, 로고 상단~중앙, Press to Start 중하단 |
| 이미지 비율 | 찌그러짐 없이 정상 표시 |
| 깜빡임 | Press to Start가 부드럽게 깜빡거림 |
| 폰트 | Neo둥근모 한글 정상 렌더링 (깨짐 없음) |
| 입력 → 씬 전환 | Phase 1과 동일하게 GameScene 정상 진입 |

---

### Phase 3: 캐릭터 달리기
- [ ] TitleCharacterRunner 컴포넌트 작성
- [ ] 캐릭터 순차 스폰 로직 (1~2초 랜덤 간격으로 누적 등장)
- [ ] 좌→우 이동 (단순 Transform.Translate)
- [ ] 화면 밖 나가면 왼쪽에서 재진입
- [ ] run 애니메이션 프레임 순환

**🧪 테스트 3: 캐릭터 동작 확인**
| 확인 항목 | 기대 결과 |
|----------|-----------|
| 첫 캐릭터 | 1초 내 화면 왼쪽에서 등장 |
| 추가 캐릭터 | 1~2초 간격으로 1마리씩 계속 추가 |
| 누적 | 10초 후 5~8마리가 동시에 달리고 있음 |
| 이동 방향 | 좌→우 일관됨 |
| 화면 밖 처리 | 오른쪽 밖으로 나간 캐릭터가 왼쪽에서 다시 나타남 |
| run 애니메이션 | 프레임이 순환되며 걷는/뛰는 모션 표시 |
| 레이어 순서 | 캐릭터가 배경 위, 타이틀 로고 아래에 표시 |
| 30초 방치 | 에러 없이 안정적으로 계속 동작 |

---

### Phase 4: 화면 전환 연출
- [ ] SceneTransitionManager 작성 (DontDestroyOnLoad)
- [ ] 블록 디졸브 아웃 구현 (UI Canvas + Image Grid, 16×10 격자)
- [ ] 블록 빌드업 인 구현
- [ ] 씬 로딩 연동 (디졸브 아웃 → LoadScene → 빌드업 인)

**🧪 테스트 4: 전환 연출 확인**
| 확인 항목 | 기대 결과 |
|----------|-----------|
| 입력 시 | Press to Start 사라짐 + 블록 디졸브 시작 |
| 디졸브 | 화면이 블록 단위로 랜덤하게 검정으로 변함 (1~1.5초) |
| 검은 화면 | 디졸브 완료 후 0.2~0.3초 검정 유지 |
| 빌드업 | GameScene이 블록 단위로 랜덤하게 나타남 (1~1.5초) |
| 빌드업 완료 | 오버레이 완전 투명, 배팅 화면 정상 조작 가능 |
| 전환 중 입력 | 무시됨 (중복 전환 없음) |
| 전환 중 캐릭터 | 디졸브 중에도 뒤에서 달리다가 자연스럽게 가려짐 |

---

### Phase 5: BGM 시스템
- [ ] BGMManager DontDestroyOnLoad 확장
- [ ] FadeIn() / FadeOut() / PlayBGM(clip) 메서드 추가
- [ ] TitleScene에서 Title_Bgm 재생
- [ ] 전환 시퀀스: 타이틀 BGM 페이드아웃 → 게임 BGM 페이드인

**🧪 테스트 5: BGM 확인**
| 확인 항목 | 기대 결과 |
|----------|-----------|
| 타이틀 진입 | Title_Bgm 즉시 루프 재생 |
| Press to Start 입력 | BGM이 서서히 작아짐 (1.5초) |
| GameScene 진입 후 | 빌드업 완료 시점에 게임 BGM 서서히 커짐 |
| BGM 전환 | 두 BGM이 겹치지 않고 자연스럽게 이어짐 |
| GameScene 기능 | BGMManager 변경으로 인한 기존 기능 깨짐 없음 |

---

### Phase 6: 최종 통합 테스트
- [ ] 콜드 스타트 (에디터 재시작 후 Play)
- [ ] 전체 플로우 3회 연속 테스트

**🧪 테스트 6: 통합 확인**
| 확인 항목 | 기대 결과 |
|----------|-----------|
| 전체 흐름 | 타이틀 → 입력 → 디졸브 → 배팅 → 레이싱 → 결과 정상 |
| 타이틀 30초 방치 | 캐릭터 누적 + BGM 루프 + 메모리 안정 |
| 빠른 연타 입력 | 전환 1회만 발생 |
| 콘솔 | Warning/Error 없음 |

---

## 10. 테스트 요약

> 각 Phase의 🧪 테스트를 참고. 핵심 체크포인트:

| Phase | 핵심 확인 | 통과 기준 |
|-------|----------|-----------|
| 1 | 씬 분리가 기존 게임을 깨뜨리지 않는가 | GameScene 배팅/레이싱 정상 |
| 2 | 이미지/폰트가 정상 표시되는가 | 찌그러짐/깨짐 없음 |
| 3 | 캐릭터가 누적 등장하고 무한 순환하는가 | 30초 방치 시 안정 |
| 4 | 블록 전환이 자연스럽고 조작 가능한가 | 빌드업 후 배팅 정상 조작 |
| 5 | BGM 전환이 끊김 없는가 | 겹침/끊김 없음 |
| 6 | 전체 플로우 3회 연속 정상 | 에러 없음 |

---

## 11. 향후 확장 고려

- **Result씬 분리:** SceneTransitionManager가 있으면 동일한 블록 전환 재사용 가능
- **캐릭터 정보창 분리:** 별도 씬 또는 오버레이 씬(Additive)으로 분리 가능
- **전환 연출 변형:** SceneTransitionManager에 TransitionType enum 추가로 다양한 전환 지원
  (블록 디졸브, 페이드, 와이프 등)

---

*이 명세서는 코드방에서 실제 구현 시 참조 문서로 사용됩니다.*
